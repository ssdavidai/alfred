
[36m============================================================
Cloudflare DNS Client Test Suite
============================================================[0m


[36m============================================================
Test 1: Client Initialization & Authentication
============================================================[0m

[34mâ„¹ Creating Cloudflare DNS client...[0m
[32mâœ“ DNS client created successfully[0m
[32mâœ“ Environment variables loaded correctly[0m
[34mâ„¹ Fetching zone information...[0m
[32mâœ“ Zone access verified: alfredos.site[0m
[32mâœ“ Zone ID: 1d85256d2ac7314f62f2064ad20fb59f[0m
[32mâœ“ Zone status: active[0m

[36m============================================================
Test 2: Create A Record
============================================================[0m

[34mâ„¹ Creating test record: test-agent-1763219341028.alfredos.site -> 1.2.3.4[0m
Creating DNS A record: test-agent-1763219341028.alfredos.site -> 1.2.3.4
DNS A record created: test-agent-1763219341028.alfredos.site (ID: d68bd212597f614a5f62eba9f7d67eff)
[32mâœ“ A record created successfully (ID: d68bd212597f614a5f62eba9f7d67eff)[0m

[36m============================================================
Test 3: Read/Get A Record
============================================================[0m

[34mâ„¹ Fetching record: test-agent-1763219341028.alfredos.site[0m
[32mâœ“ Record found: test-agent-1763219341028.alfredos.site -> 1.2.3.4[0m
[32mâœ“ IP address matches expected value: 1.2.3.4[0m
[32mâœ“ TTL is correct: 300 seconds[0m
[32mâœ“ Proxied setting is correct: false[0m

[36m============================================================
Test 4: Update A Record
============================================================[0m

[34mâ„¹ Updating record to point to 5.6.7.8[0m
DNS A record updated: test-agent-1763219341028.alfredos.site -> 5.6.7.8
[32mâœ“ A record updated successfully[0m
[32mâœ“ IP address updated correctly: 5.6.7.8[0m

[36m============================================================
Test 5: Validate Zone Record Listing
============================================================[0m

[34mâ„¹ Listing A records in zone...[0m
[32mâœ“ Found 1 A records in zone[0m
[32mâœ“ Test record found in zone listing: test-agent-1763219341028.alfredos.site -> 5.6.7.8[0m

[36m============================================================
Test 5a: Error Handling - Duplicate Records
============================================================[0m

[34mâ„¹ Attempting to create duplicate record...[0m
[34mâ„¹ Note: Cloudflare allows duplicate A records (valid DNS behavior)[0m
Creating DNS A record: test-agent-1763219341028.alfredos.site -> 9.9.9.9
DNS A record created: test-agent-1763219341028.alfredos.site (ID: 5c51f4f5ce85b1a59a470d813df025aa)
[32mâœ“ Cloudflare allows duplicate A records (this is valid DNS behavior)[0m
[34mâ„¹ Cleaning up duplicate record...[0m
DNS A record deleted: test-agent-1763219341028.alfredos.site (ID: 5c51f4f5ce85b1a59a470d813df025aa)
DNS A record deleted: test-agent-1763219341028.alfredos.site (ID: d68bd212597f614a5f62eba9f7d67eff)
[32mâœ“ All duplicate records cleaned up[0m

[36m============================================================
Test 6: Delete A Record
============================================================[0m

[34mâ„¹ Deleting test record: test-agent-1763219341028.alfredos.site[0m
No DNS A record found for test-agent-1763219341028.alfredos.site
[32mâœ“ A record deleted successfully[0m
[32mâœ“ Record verified as deleted[0m

[36m============================================================
Test 7: Error Handling - Delete Non-existent Record
============================================================[0m

[34mâ„¹ Attempting to delete non-existent record...[0m
No DNS A record found for nonexistent-1763219341028.alfredos.site
[32mâœ“ Non-existent record deletion handled gracefully[0m

[36m============================================================
Test 8: Error Handling - Update Non-existent Record
============================================================[0m

[34mâ„¹ Attempting to update non-existent record...[0m
Failed to update DNS A record for nonexistent-1763219341028.alfredos.site: Error: No DNS A record found for nonexistent-1763219341028.alfredos.site
    at CloudflareDNSClient.updateARecord (/Users/Shared/dev/alfredos-cloud/template/app/src/cloud/cloudflare/dns.ts:136:15)
    at process.processTicksAndRejections (node:internal/process/task_queues:103:5)
    at async runTests (/Users/Shared/dev/alfredos-cloud/template/app/src/cloud/cloudflare/test-dns.ts:172:7)
[32mâœ“ Update failure handled correctly: DNS record update failed: No DNS A record found for nonexistent-1763219341028.alfredos.site[0m

[36m============================================================
Test Summary
============================================================[0m

[32mâœ“ All tests completed successfully![0m
[32mâœ“ DNS client authentication: PASSED[0m
[32mâœ“ Zone access validation: PASSED[0m
[32mâœ“ Create A record: PASSED[0m
[32mâœ“ Read A record: PASSED[0m
[32mâœ“ Update A record: PASSED[0m
[32mâœ“ List records: PASSED[0m
[32mâœ“ Delete A record: PASSED[0m
[32mâœ“ Error handling: PASSED[0m
[32mâœ“ TTL configuration: PASSED (300 seconds)[0m
[32mâœ“ Proxied setting: PASSED (false)[0m
[32mâœ“ Cleanup: COMPLETE[0m

[32m============================================================
ALL TESTS PASSED - DNS Client is fully functional!
============================================================[0m

